package edu.harvard.we99.services.experiments;

import edu.harvard.we99.domain.Experiment;
import edu.harvard.we99.domain.Plate;
import edu.harvard.we99.services.storage.PlateStorage;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import javax.annotation.Generated;
import javax.ws.rs.WebApplicationException;
import javax.ws.rs.core.Response;

/**
 * @author mford
 */
public abstract class PlateResourceImpl implements PlateResource {

    private static final Logger log = LoggerFactory.getLogger(PlateResourceImpl.class);

    private Long plateId;
    private final PlateStorage plateStorage;
    private Experiment experiment;

    public PlateResourceImpl(PlateStorage plateStorage) {
        this.plateStorage = plateStorage;
    }

    @Override
    public Plate get() {
        try {
            return plateStorage.get(plateId);
        } catch(Exception e) {
            log.error("error getting plate resource {}", plateId, e);
            throw new WebApplicationException(Response.serverError().build());
        }
    }

    @Override
    public Plate update(Plate plate) {
        try {
            return plateStorage.update(plateId, plate);
        } catch(Exception e) {
            log.error("error updating plate resource {} with {}", plateId, plate, e);
            throw new WebApplicationException(Response.serverError().build());
        }
    }

    @Override
    public Response delete() {
        plateStorage.delete(plateId);
        return Response.ok().build();
    }

    @Override
    public PlateResultResource getPlateResult() {
        PlateResultResource prr = createPlateResult();
        prr.setExperiment(experiment);
        prr.setPlateId(plateId);
        return prr;
    }

    protected abstract PlateResultResource createPlateResult();

    @Override
    public void setPlateId(Long plateId) {
        this.plateId = plateId;
    }

    @Override
    @Generated("generated by IDE")
    public Experiment getExperiment() {
        return experiment;
    }

    @Override
    @Generated("generated by IDE")
    public void setExperiment(Experiment experiment) {
        this.experiment = experiment;
    }
}
