package edu.harvard.we99.services.experiments;

import edu.harvard.we99.domain.Experiment;
import edu.harvard.we99.domain.lists.PlateResultEntries;
import edu.harvard.we99.services.BaseRESTServiceImpl;
import edu.harvard.we99.services.storage.ExperimentStorage;
import edu.harvard.we99.services.storage.ResultStorage;

import javax.annotation.Generated;
import javax.ws.rs.core.Response;

/**
 * @author mford
 */
public abstract class ExperimentResourceImpl extends BaseRESTServiceImpl<Experiment>  implements ExperimentResource {

    private Long id;
    private final ResultStorage resultStorage;

    public ExperimentResourceImpl(ExperimentStorage storage,
                                  ResultStorage resultStorage) {
        super(storage);
        this.resultStorage = resultStorage;
    }

    @Override
    public Experiment get() {
        return super.get(id);
    }

    @Override
    public Experiment update(Experiment experiment) {
        return super.update(id, experiment);
    }

    @Override
    public Response delete() {
        deleteImpl(id);
        return Response.ok().build();
    }

    @Override
    public MemberResource getMembers() {
        MemberResource mr = createMemberResource();
        mr.setId(id);
        return mr;
    }

    @Override
    public PlatesResource getPlates() {
        PlatesResource pr = createPlatesResource();
        pr.setId(id);
        return pr;
    }

    protected abstract PlatesResource createPlatesResource();

    @Override
    public PlateResultEntries listResults() {
        return new PlateResultEntries(resultStorage.listAllByExperiment(id));
    }

    protected abstract MemberResource createMemberResource();


    @Generated(value = "generated by IDE")
    public Long getId() {
        return id;
    }

    @Generated(value = "generated by IDE")
    public void setId(Long id) {
        this.id = id;
    }
}
